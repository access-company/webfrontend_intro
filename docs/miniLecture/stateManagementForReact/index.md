# React の状態管理について

状態管理は React で開発したアプリケーションの中心的な部分を担っています。

状態（State）とは、ユーザーの操作や外部からのデータによって変わる、アプリの中の情報を指します。

例えば、「ボタンを押したら色が変わる」「フォームに入力された文字が画面に表示される」など、見た目や動作に変化を与えるデータが状態（State）です。

例

- フォームの入力値
- ボタンの ON/OFF
- API から取得したユーザー情報
- ログイン状態

---

## State について

### Local State

1 つのコンポーネント、または親子関係にある少数のコンポーネント間で完結する State を指します。

例

- フォームの入力値
- ボタンの ON/OFF
- モーダルの開閉状態

管理方法

- useState
- useReducer（複雑な状態の場合）

注意点

多くのコンポーネントを経由すると管理が複雑になります。

例えば、あるコンポーネントが State を持っていて、その State がそのコンポーネントの従兄弟や再従兄弟に当たるコンポーネントで必要となる場合、それらに至るまでのコンポーネントを通して State を渡さなければなりません。(いわゆるバケツリレー)

これは非効率的であり、保守性や可読性にも影響を与えます。

props バケツリレーの例
![propsバケツリレーの例](https://blog.uhy.ooo/static/823156092a07e828c91f4287a0deaaed/922e6/useState.png)

参照元：[React ステート管理 比較考察](https://blog.uhy.ooo/entry/2021-07-24/react-state-management/)

### Global State

複数のコンポーネントで共有される State、あるいはアプリケーション全体で共通して使う必要がある State を指します。

例

- ログインしているユーザーの情報（user.id, user.name など）
- アプリ全体のテーマ（ダーク/ライト）
- カート内の商品の情報（EC サイト）
- 言語設定（日本語/英語）

Global State の例
![Global Stateの例](https://storage.googleapis.com/zenn-user-upload/7cc2ba94bae7-20220216.png)

参照元：[トップダウン型の状態管理 (#Redux #Zustand )と比較して知るボトムアップ型の状態管理 (#Recoil #Jotai )](https://zenn.dev/jotaifriends/articles/d714f9c16c1d3a)

管理方法

- useContext（軽量な共有）
- 外部状態管理ライブラリ（Zustand、Jotai など）

注意点

小さな UI の State まで全てグローバルで扱うと、関係のないコンポーネントの再レンダリングが発生したり、どこから変更されているか分からなくなるといった問題が起こりやすくなります。

そのため、Global と Local での State の使い分けを設計することが重要です。

| 状態のスコープ | 例                                         | 主な管理方法                   |
| -------------- | ------------------------------------------ | ------------------------------ |
| Local          | テキスト入力、モーダル表示、チェック状態   | `useState`, `useReducer`       |
| Global         | ログイン情報、テーマ、言語設定、カート情報 | `useContext`, 外部ライブラリ等 |

---

## 発展

React アプリケーションをスケーラブル、かつ保守性高く作るためには、State の扱い方に一定のルールや考え方を持っておくことが大切です。

### State の種類を明確に分ける（責務の分離）

| 種類                     | 説明                                          | 例                                         |
| ------------------------ | --------------------------------------------- | ------------------------------------------ |
| サーバー由来の State     | 外部 API や DB から取得したデータ             | ユーザー一覧、記事データなど               |
| クライアント由来の State | UI の表示やユーザー操作に関するローカルな状態 | モーダルの開閉、チェックボックスの状態など |

サーバーから取得するデータは通信・キャッシュ・再取得などの制御を行う。

UI の一時的な State とは切り離して、責務を混在させないことで、コードの見通しがよくなり、将来的な修正や機能追加の開発が行いやすい。

### Global State の乱用を避ける

アプリ全体で共有したい情報（ログインユーザー情報やテーマ設定など）は、「Global State」として管理します。

軽量な共有であれば useContext、より柔軟で効率的な管理が必要な場合は外部ライブラリ（例：Zustand、Jotai など）を用いることが一般的です。

次のような状態は、ローカルに閉じた UI の一部であるため、Global にせず「Local State」として扱うのが適しています。

- ボタンの ON/OFF
- 入力欄の入力値
- 画面内でのみ使うフィルター条件

ローカルで完結する状態は useState を活用し、「必要なときだけ、必要な場所で」State を管理する意識が大切です。

### サーバー状態は専用の仕組みで同期・キャッシュする（React Query、SWR）

サーバーから取得するデータ（API 通信結果）は、以下のような特性があります。

- 通信中のローディング状態やエラー処理
- データをキャッシュして無駄な再取得の回避
- フォーム送信後、ブラウザのタブ切り替え時は自動で再取得

これらを手動で実装するとコードが煩雑になるため、React Query（@tanstack/react-query）、SWR などの専用ライブラリを使うのが一般的です。

#### React Query の特長

- API 通信の結果をキャッシュして再利用
- 通信中・成功・エラーの状態を取得
- キャッシュの更新や再取得を明示的に制御
- サーバー状態の自動同期が可能

以上となります。

簡単ではありますが、React で状態管理の概念とそれぞれの使い分けについて説明しました。
